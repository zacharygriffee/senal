const e="senal-",t=Symbol.for(`${e}ig`),r=Symbol.for(`${e}ra`),n=Symbol.for(`${e}tada`),o=Symbol.for(`${e}incit`);function i(e){const t=e?.[n];if(t)return t.paused++,l.bind({done:!1},t)}function l(e){this.done||(e.paused=Math.max(e.paused-1,0),this.done=!0)}function c(e){if("object"!=typeof e||Array.isArray(e))throw new Error("Cannot ignore passed argument");return e[t]=!0,e}function u(e){return"function"==typeof e}function s(e=1){return e instanceof Error||e?.message?f([a(e.stack)[0]])[0]:((e=Math.max(e,1))!=e&&(e=1),a((new Error).stack).slice(e).map((e=>f(e))))}function f(e){return Object.assign(e,{calleeShort:e.calleeShort||(e.callee||"").split(".")[(e.callee||"").split(".").length-1]})}function a(e){return e.split("\n").map((e=>{let t,r,n,o=[];if((r=(e=e.trim()).match(/at (.+) \(eval at .+ \((.+)\), .+\)/))||(r=e.match(/at (.+) \((.+)\)/))||"at "!==e.slice(0,3)&&(r=e.match(/(.*)@(.*)/)))t=r[1],o=(r[2].match(/(.*):(\d+):(\d+)/)||r[2].match(/(.*):(\d+)/)||[]).slice(1);else{if(!(n=e.match(/^(at\s+)*(.+):(\d+):(\d+)/)))return;o=n.slice(2)}return{file:o[0],beforeParse:e,callee:t||"",line:parseInt(o[1]||"",10)||void 0,column:parseInt(o[2]||"",10)||void 0}})).filter((e=>void 0!==e))}const d=["initial","collection","property","manual","complete","error"];function p(e,t,i={},l=3){if("string"!=typeof t)throw new Error("reason must be a string");let c,u;("object"!=typeof i||Array.isArray(i))&&(i={value:i}),"error"===t?u=s(i.error):(c=s(),u=c[l]);const{callee:f,line:a,column:d,file:p,beforeParse:b}=u;let y=Symbol.for(t+"#"+b),m={...i,cause:e,reason:t,symbol:y,callee:f,line:a,column:d,file:p,stack:c};return m=e?.[r]?{...m,isSenal:!0}:e?.[n]?{...m,isTada:!0}:{...m},Object.defineProperty(m,o,{enumerable:!1,configurable:!1,writable:!1,value:!0}),m}function b(e,t,r={}){if(d.includes(t))throw new Error(`Cannot use reserved reason "${t}".`);return Object.freeze(p(e,t,r,4))}function y(e,t){return e.filter(((r,n)=>e.findIndex((e=>t(r,e)))===n))}let m=[],h=[],g=new Map;function w(e,t){if(e.filters?.length){let n=!0;const o=[...e.filters.flat(1/0)];for(const e of o)if(e&&"object"==typeof e){const t=Object.entries(e).filter((([,e])=>!!e?.[r]));for(let[e,r]of t)o.push(r?.[e])}else if(!1===e||!0===e){if(!(n=e))break}else if(u(e)&&!(n=!1!==n&&!!e(t)))break;return n&&o.filter((e=>"string"==typeof e)).includes(t.reason)}return!1}function O(e){return e.completed||e.errored}const{push:j,pop:v,clear:A}=new function(e){const t=e,r=new Set,n=new Set;return{push:function(e,n=t){n&&[...r].find((t=>n(t,e)))||r.add(e)},pop:function(){let e=[...r].find((e=>!n.has(e)));return void 0!==e&&n.add(e),e},remaining:function(){return r.size-n.size},queued:r,processed:n,clear:function(){r.clear(),n.clear()}}};let x,S=!1;function P(e,t){if(!(O(e=e[n])||e.paused||e.inQueue||(j(e,((e,t)=>e.id===t.id)),e.inQueue=!0,t?.[o]||(t=p(e,"manual",t)),t=Object.freeze(t),S))){let r;for(S=!0;r=v();){if(w(r,t)){if(O(r)||r.paused)continue;if(O(e)||e.paused)break;x=r;try{(r._next||r.next)(t)}catch(e){S=!1,A(),e.inciter=t,r.error(e);break}x=void 0}r.inQueue=!1}S=!1,A()}}function E(e){return[e?.next,e?.error,e?.complete].some(u)}function k(e,...t){if(!function(e){return!!u(e)||E(e)}(e))throw new Error("Computed function should be an observer or function.");if(e[n]?.disposed)return;const r=e;let o,i,l,c;const s=t=>{e.next(t)};if(s.unsubscribe=a,e?.[n])e=r[n],i=e.error,l=e.complete;else{if(e={started:!1,completed:!1,errored:!1,inQueue:!1,readOnly:!1,paused:0,id:Symbol(),next:function(t){if(O(e))return c;!e.started&&w({filters:e.filters},{reason:"initial"})&&P(e,p(e,"initial"));return e.started=!0,P(e,t),c},error:function(t){return O(e)||(P(e,p(e,"error",{error:t})),e.errored=!0,(i||(e=>{throw e}))(t)),c},complete:f,completeNextTick:function(){return setTimeout(f),c},addFilter:function(...t){if(O(e))return e;for(const r of t.flat(1/0))e.filters.includes(r)||e.filters.push(r);return c},unsubscribe:a,*[Symbol.iterator](){const t=function(e,t=!0){const r=e[n];let o=r.readOnly;try{m=[],r.readOnly=!0;const e=p(r,"collection");return r.next(e),r.readOnly=o,t&&(m=y(m,((e,t)=>e.symbol===t.symbol))),[...m]}finally{m=[]}}(e);for(const e of t)"symbol"!=typeof e&&(yield e)}},e.filters=t.length?t.flat(1/0):["initial","property","collection","manual"],E(r)){const{next:t,error:n,complete:c,...u}=r;o=t,i=n,l=c,e={...e,...u}}else o=r;[e,r,s].forEach((t=>{Object.defineProperty(t,n,{value:e,configurable:!0,writable:!0,enumerable:!1})}))}return u(o)&&(e._next||=o),e.completed&&e.complete(),(!e.inQueue||e.errored||e.completed)&&w({filters:e.filters},{reason:"initial"})&&(P(e,p(e,"initial")),e.started=!0),c=new Proxy(s,{get:(t,r,n)=>Reflect.get(e,r,n),set:(t,r,n,o)=>(O(e)||(e[r]=n),!0)}),c;function f(){return O(e)||(P(e,p(e,"complete")),e.completed=!0,l?.()),c}function a(){e.complete()}}function N(e){let t=!1,r=e||x;if(r?.[n]){if(r[n].disposed)return e;r[n].complete()}else t=!0;if("function"!=typeof r&&"object"!=typeof r)throw new Error("Computed must be an observer or function.");return t&&(e[n]={disposed:!0}),e}const T=Object.getOwnPropertyNames(Object.getPrototypeOf({}));function _(e){return null!=e&&("object"==typeof e||"function"==typeof e)}const z=Object.getOwnPropertyNames(Object.getPrototypeOf([]));function Q(e){let t=[];for(let r in e)t[+r]=e[r];return t}function R(e={},n={}){const{deep:o=!0,subscribeOnSet:i=!1,startReactive:l=!0,arrayToObject:c=!1}=n;if(!_(e))throw new Error("Senals first argument must be an object");const u=e=>(Array.isArray(e)||null!=e?.length&&"object"==typeof e)&&c;if(Array.isArray(e)&&!u(e))throw new Error("Arrays are not observable unless arrayToObject = true");u(e)&&(e=function(e){const t=e.length;return{...e,length:t}}(e));const s={},f={};let a=e?.[t];if(e[r])return e;if(e[r]=!0,o&&!a)for(const[t,r]of Object.entries(e))(_(r)||u(r))&&(Array.isArray(r)&&!u(r)||(e[t]=R(r)));function d(e,t){if(!a&&s[e]&&(function(e){return T.includes(e)}(e)&&![void 0,!0].includes(f[e])&&(f[e]=void 0),!f[e])){f[e]=!0;for(const r of s[e])r&&(r.completed||r.errored?delete s[e]:P(r,p(O,"property",t)));delete f[e]}}function b(e,t,r="get"){x?.errored||x?.completed?s[t]&&delete s[t]:function(e){if(h.length=0,m.push(e),m=y(m,((e,t)=>e.symbol===t.symbol)),h=[...m,...h],g.size>0)for(let e of g.values())e.push(...m);setTimeout((()=>{m.length=0}))}(p(e,"property",{type:r,property:t,tada:x}))}function w(e,t){a||!function(e,t){if(null==e[t])return!0;const r=Object.getOwnPropertyDescriptor(e,t);return"__proto__"!==t&&{}.hasOwnProperty.call(e,t)&&r.configurable&&r.enumerable}(e,t)&&!u(e[t])||(e[t]&&!Object.getOwnPropertyDescriptor(e,t)?.writable&&Object.defineProperty(e,t,{value:e[t],writable:!0,enumerable:!0,configurable:!0}),x&&(Array.isArray(s[t])||(s[t]=[]),s[t].find((e=>e.id===x.id))||s[t].push(x)))}const O=new Proxy(e,{get(r,n,o){if(n===t)return a;if(n===Symbol.iterator&&u(e)){const i=Q(e);return function*(){for(let e of i)null!=e&&(yield e)}}if("symbol"!=typeof n)if(u(e)){if("length"===n)w(r,n),b(r,n,"get");else{if(z.includes(n)){let f=Q(r);const p=f.length;return(...e)=>{let t=f[n](...e);Array.isArray(t)&&(f=t);for(let e=0;e<Math.max(f.length,r.length);e++)if(r[e]!==f[e])if(null!=f[e]){const t=r[e];r[e]=f[e],d(e,{value:r[e],prevValue:t}),b(r,e,"set")}else delete r[e];return r.length=Array.isArray(t)?t.length:Number(t)==Number(t)&&t>=0?t:null,c(p,r.length),t}}Number(n)==Number(n)&&l()}if(null!=r[n])return Reflect.get(r,n,o);function l(){for(let e=0;e<+n;e++)s[e]||w(r,e);const e=r.length,t=+(Object.keys(r).filter((e=>"length"!==e&&Number(e)==Number(e))).sort(((e,t)=>+e==+t)).reverse()[0]||0);c(e,0===t?0:t+1)}function c(e,t){r.length=t,d("length",{value:t,oldLength:e}),b(r,"length","set")}}else w(r,n),b(r,n,"get");return Reflect.get(r,n,o)},set(e,r,n,l){let c=e[r];return r===t?(a=n,!0):(o&&(_(n)||u(n))&&(Array.isArray(n)&&!u(n)||(n=R(n))),i&&w(e,r),(x&&!x.readOnly||!x)&&Reflect.set(e,r,n,l),d(r,{value:n,prevValue:c}),b(e,r,"set"),!0)}});return O}export{N as dispose,c as ignore,b as inciter,i as pause,R as senal,k as tada};
