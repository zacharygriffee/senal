const e="senal-",t=Symbol.for(`${e}ig`),r=Symbol.for(`${e}ra`),n=Symbol.for(`${e}in`),o=Symbol(),i=Symbol(),l=Symbol(),u=Symbol.for(`${e}tada`),a=Symbol.for(`${e}incit`),c=Symbol.for(`${e}inv`),s=Symbol.for(`${e}invr`);function f(e){const t=e?.[u];if(t)return t.paused++,p.bind({done:!1},t)}function p(e){this.done||(e.paused=Math.max(e.paused-1,0),this.done=!0)}function b(e){if("object"!=typeof e||Array.isArray(e))throw new Error("Cannot ignore passed argument");return e[t]=!0,e}function y(e){return"function"==typeof e}function m(e=1){return e instanceof Error||e?.message?d([g(e.stack)[0]])[0]:((e=Math.max(e,1))!=e&&(e=1),g((new Error).stack).slice(e).map((e=>d(e))))}function d(e){return Object.assign(e,{calleeShort:e.calleeShort||(e.callee||"").split(".")[(e.callee||"").split(".").length-1]})}function g(e){return e.split("\n").map((e=>{let t,r,n,o=[];if((r=(e=e.trim()).match(/at (.+) \(eval at .+ \((.+)\), .+\)/))||(r=e.match(/at (.+) \((.+)\)/))||"at "!==e.slice(0,3)&&(r=e.match(/(.*)@(.*)/)))t=r[1],o=(r[2].match(/(.*):(\d+):(\d+)/)||r[2].match(/(.*):(\d+)/)||[]).slice(1);else{if(!(n=e.match(/^(at\s+)*(.+):(\d+):(\d+)/)))return;o=n.slice(2)}return{file:o[0],beforeParse:e,callee:t||"",line:parseInt(o[1]||"",10)||void 0,column:parseInt(o[2]||"",10)||void 0}})).filter((e=>void 0!==e))}function h(e,t){if(e.filters?.length){let n=!0;const o=[...e.filters.flat(1/0)];for(const e of o)if(e&&"object"==typeof e){const t=Object.entries(e).filter((([,e])=>!!e?.[r]));for(let[e,r]of t)o.push(r?.[e])}else if(!1===e||!0===e){if(!(n=e))break}else if(y(e)&&!(n=!1!==n&&!!e(t)))break;return n&&o.filter((e=>"string"==typeof e)).includes(t.reason)}return!1}function v(e){return e&&(e.completed||e.errored)}const{push:w,pop:O,clear:A}=new function(e){const t=e,r=new Set,n=new Set;return{push:function(e,n=t){n&&[...r].find((t=>n(t,e)))||r.add(e)},pop:function(){let e=[...r].find((e=>!n.has(e)));return void 0!==e&&n.add(e),e},remaining:function(){return r.size-n.size},queued:r,processed:n,clear:function(){r.clear(),n.clear()}}};let j,S,x=!1;function P(e,t){if(!(v(e=e[u])||e.paused||e.inQueue||(w(e,((e,t)=>e.id===t.id)),e.inQueue=!0,t?.[a]||(t=E(e,"manual",t)),t=Object.freeze(t),x))){let r;for(x=!0;r=O();){if(h(r,t)){if(v(r)||r.paused)continue;if(v(e)||e.paused)break;S=t,j=r;try{S[s](r._next),r._next(t)}catch(e){x=!1,A(),e.inciter=t,r.error(e);break}finally{S[s](null),S=void 0,j=void 0}}r.inQueue=!1}x=!1,A()}}const k=["initial","collection","property","manual","complete","error","invocation"];function E(e,t,o={},i=3){if("string"!=typeof t)throw new Error("reason must be a string");let l,f;("object"!=typeof o||Array.isArray(o))&&(o={value:o}),"error"===t?f=m(o.error):(l=m(),f=l[i]);const{callee:p,line:b,column:y,file:d,beforeParse:g}=f;let h,v=Symbol.for(t+"#"+g),w={...o,cause:e,reason:t,symbol:v,callee:p,line:b,column:y,offset:i,file:d,stack:l};return w=e?.[n]&&e?.[r]?{...w,isInvocation:!0,isSenal:!0}:e?.[r]?{...w,isSenal:!0}:e?.[u]?{...w,isTada:!0}:{...w},Object.defineProperties(w,{[a]:{enumerable:!1,configurable:!1,writable:!1,value:!0},[c]:{enumerable:!1,configurable:!1,writable:!1,value:e=>{!function(e,t,r){let n=j,o=S;j=e,S=t,r(),j=n,S=o}(w.cause,e,(()=>{h?.(e)}))}},[s]:{enumerable:!0,configurable:!0,writable:!0,value:e=>{h=e}}}),w}function N(e,t,r={}){if(k.includes(t))throw new Error(`Cannot use reserved reason "${t}".`);return Object.freeze(E(e,t,r,4))}function $(e,t){return e.filter(((r,n)=>e.findIndex((e=>t(r,e)))===n))}let _;_="function"==typeof queueMicrotask?queueMicrotask:e=>Promise.resolve().then(e);let M=[],R=[],V=new Map;function I(e){const t=Symbol(),r=[];V.set(t,(t=>{for(const n of t)r.find((e=>e===n.symbol))||(r.push(n.symbol),e(n))})),_((()=>V.delete(t)))}function z(e){return[e?.next,e?.error,e?.complete].some(y)}function Q(e,...t){if(!function(e){return!!y(e)||z(e)}(e))throw new Error("Computed function should be an observer or function.");if(e[u]?.disposed)return;const l=e;let a,c,f,p;const b=t=>{e.next(t)};if(b.unsubscribe=d,e?.[u])e=l[u],c=e.error,f=e.complete;else{if(e={started:!1,completed:!1,errored:!1,inQueue:!1,readOnly:!1,paused:0,id:Symbol(),next:function(t){if(v(e))return p;!e.started&&h({filters:e.filters},{reason:"initial"})&&P(e,E(e,"initial"));return e.started=!0,P(e,t),p},error:function(t){return v(e)||(P(e,E(e,"error",{error:t})),e.errored=!0,(c||(e=>{throw e}))(t)),p},complete:m,completeNextTick:function(){return _(m),p},addFilter:function(...t){if(v(e))return p;for(const r of t.flat(1/0))e.filters.includes(r)||e.filters.push(r);return p},unsubscribe:d,retro:function(t=!1){const n=function(){try{return[...$(R,((e,t)=>e.symbol===t.symbol))]}finally{M=[],R=[]}}();for(const{cause:l,property:u,type:a}of n)(t||"get"===a)&&l[r]&&(l[o](e,u),l[i](u));return p},pronto:function(t=!1){return v(e)||I((n=>{const{cause:l,property:u,type:a}=n;(t||"get"===a)&&l[r]&&(l[o](e,u),l[i](u))})),p},intercept:function(){return v(e)||I((t=>{const{cause:o,type:i,thisArg:l,args:u,[s]:a}=t;"invoke"===i&&o[r]&&o[n]&&(!function(e,t){j=e,S=t}(e,t),a(e._next),o[n](o,u,l,7))})),p},*[Symbol.iterator](){const t=function(e,t=!0){const r=e[u];let n=r.readOnly;try{M=[],r.readOnly=!0;const e=E(r,"collection");return r.next(e),r.readOnly=n,t&&(M=$(M,((e,t)=>e.symbol===t.symbol))),[...M]}finally{M=[]}}(e);for(const e of t)"symbol"!=typeof e&&(yield e)}},e.filters=t.length?t.flat(1/0):["initial","invocation","property","collection","manual"],z(l)){const{next:t,error:r,complete:n,...o}=l;a=t,c=r,f=n,e={...e,...o}}else a=l;[e,l,b].forEach((t=>{Object.defineProperty(t,u,{value:e,configurable:!0,writable:!0,enumerable:!1})}))}return y(a)&&(e._next||=a),e.completed&&e.complete(),(!e.inQueue||e.errored||e.completed)&&h({filters:e.filters},{reason:"initial"})&&(P(e,E(e,"initial")),e.started=!0),p=new Proxy(b,{get:(t,r,n)=>Reflect.get(e,r,n),set:(t,r,n,o)=>(v(e)||(e[r]=n),!0)}),p;function m(){return v(e)||(P(e,E(e,"complete")),e.completed=!0,f?.()),p}function d(){e.complete()}}const T=Object.getOwnPropertyNames(Object.getPrototypeOf({}));function q(e){return null!=e&&("object"==typeof e||"function"==typeof e)}const C=Object.getOwnPropertyNames(Object.getPrototypeOf([]));function D(e){let t=[];for(let r in e)t[+r]=e[r];return t}let F;function B(e={},u={}){const{deep:a=!0,subscribeOnSet:s=!1,startReactive:f=!0,arrayToObject:p=!1}=u;if(!q(e))throw new Error("Senals first argument must be an object");const b=e=>(Array.isArray(e)||null!=e?.length&&"object"==typeof e)&&p;if(Array.isArray(e)&&!b(e))throw new Error("Arrays are not observable unless arrayToObject = true");b(e)&&(e=function(e){const t=e.length;return{...e,length:t}}(e));const y={},m={};let d,g,h=e?.[t];if(e[r])return e;if(e[r]=!0,a&&!h)for(const[t,r]of Object.entries(e))(q(r)||b(r))&&(Array.isArray(r)&&!b(r)||(e[t]=B(r)));function w(e,t,r="property"){if(!h&&y[e]&&(function(e){return T.includes(e)}(e)&&![void 0,!0].includes(m[e])&&(m[e]=void 0),!m[e])){m[e]=!0;for(const n of y[e])n&&(n.completed||n.errored?delete y[e]:P(n,E(N,r,t)));delete m[e]}}function O(e,t,r="get",n="property",o={}){v(j)?y[t]&&delete y[t]:function(e){if(R.length=0,M.push(e),M=$(M,((e,t)=>e.symbol===t.symbol)),R=[...M,...R],V.size>0)for(let e of V.values())"function"==typeof e?e(M):e.push(...M);_((()=>{M.length=0}))}(E(e,n,{type:r,property:t,tada:j,...o}))}function A(e,t,r=j){h||!function(e,t){if(null==e[t])return!0;const r=Object.getOwnPropertyDescriptor(e,t);return"__proto__"!==t&&{}.hasOwnProperty.call(e,t)&&r.configurable&&r.enumerable}(e,t)&&!b(e[t])&&t!==n||(t!==n&&e[t]&&!Object.getOwnPropertyDescriptor(e,t)?.writable&&Object.defineProperty(e,t,{value:e[t],writable:!0,enumerable:!0,configurable:!0}),r&&(Array.isArray(y[t])||(y[t]=[]),y[t].find((e=>e.id===r.id))||y[t].push(r)))}Object.defineProperties(e,{[o]:{enumerable:!1,configurable:!1,value:(t,r)=>A(e,r,t)},[i]:{enumerable:!1,configurable:!1,writeable:!1,value:(t,r={})=>w(t,{...r,value:e[t]})},[l]:{enumerable:!1,configurable:!1,writeable:!1,value:(t,r)=>O(e,t,r)},[n]:{enumerable:!1,configurable:!1,writeable:!1,value:"function"==typeof e&&k},id:{enumerable:!1,configurable:!1,writable:!1,value:Symbol()}});let x=!1;function k(e,t,r,n=3){function o(e,t){for(let r=0;r<Math.max(t.length,e.length);r++)void 0===t[r]&&(t[r]=e[r]);return t}v(j)||S[c](E(e,"invocation",{accept:(...e)=>{g.args=o(t,e),g.thisArg=r},instead:(e,...n)=>{g.args=o(t,n),g.thisArg=r,g.target=e},shim:e=>{g.returnValue=e},args:t,thisArg:r,isInvocation:!0,property:F},n))}e[n]&&(d=Symbol(),g={target:d,returnValue:d,args:d,thisArg:d});const N=new Proxy(e,{...e[n]?{apply(e,t,r){if(A(e,n),O(e,n,"invoke","invocation",{thisArg:t,args:r}),e?.name&&(F=e.name),j&&!x)x=!0,k(e,r,t),x=!1;else if(x&&S?.isInvocation)return;if(Object.values(g).some((e=>e!==d)))try{let{returnValue:n,args:o,thisArg:i,target:l}=g;return n!==d?n:(o=o===d?r:o,i=i===d?t:i,l=l===d?e:l,Reflect.apply(l,i,o))}finally{g.returnValue=d,g.thisArg=d,g.args=d}return Reflect.apply(e,t,r)}}:{},get(r,n,o){if("function"==typeof r[n]&&(F=n),n===t)return h;if(n===Symbol.iterator&&b(e)){const i=D(e);return function*(){for(let e of i)null!=e&&(yield e)}}if("symbol"!=typeof n)if(b(e)){if("length"===n)A(r,n),O(r,n,"get");else{if(C.includes(n)){let a=D(r);const c=a.length;return(...e)=>{let t=a[n](...e);Array.isArray(t)&&(a=t);for(let e=0;e<Math.max(a.length,r.length);e++)if(r[e]!==a[e])if(null!=a[e]){const t=r[e];r[e]=a[e],w(e,{value:r[e],prevValue:t,property:e}),O(r,e,"set")}else delete r[e];return r.length=Array.isArray(t)?t.length:Number(t)==Number(t)&&t>=0?t:null,u(c,r.length),t}}Number(n)==Number(n)&&l()}if(null!=r[n])return Reflect.get(r,n,o);function l(){for(let e=0;e<+n;e++)y[e]||A(r,e);const e=r.length,t=+(Object.keys(r).filter((e=>"length"!==e&&Number(e)==Number(e))).sort(((e,t)=>+e==+t)).reverse()[0]||0);u(e,0===t?0:t+1)}function u(e,t){r.length=t,w("length",{value:t,prevValue:e,property:"length"}),O(r,"length","set")}}else A(r,n),O(r,n,"get");return Reflect.get(r,n,o)},set(e,r,n,o){let i=e[r];return r===t?(h=n,!0):(a&&(q(n)||b(n))&&(Array.isArray(n)&&!b(n)||(n=B(n))),s&&A(e,r),(j&&!j.readOnly||!j)&&Reflect.set(e,r,n,o),w(r,{value:n,prevValue:i,property:r}),O(e,r,"set"),!0)}});return N}export{b as ignore,N as inciter,f as pause,B as senal,Q as tada};
