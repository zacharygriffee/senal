const e="senal-",t=Symbol.for(`${e}ig`),r=Symbol.for(`${e}ra`),n=Symbol(),o=Symbol(),i=Symbol(),l=Symbol.for(`${e}tada`),u=Symbol.for(`${e}incit`);function c(e){const t=e?.[l];if(t)return t.paused++,s.bind({done:!1},t)}function s(e){this.done||(e.paused=Math.max(e.paused-1,0),this.done=!0)}function f(e){if("object"!=typeof e||Array.isArray(e))throw new Error("Cannot ignore passed argument");return e[t]=!0,e}function a(e){return"function"==typeof e}function p(e=1){return e instanceof Error||e?.message?d([b(e.stack)[0]])[0]:((e=Math.max(e,1))!=e&&(e=1),b((new Error).stack).slice(e).map((e=>d(e))))}function d(e){return Object.assign(e,{calleeShort:e.calleeShort||(e.callee||"").split(".")[(e.callee||"").split(".").length-1]})}function b(e){return e.split("\n").map((e=>{let t,r,n,o=[];if((r=(e=e.trim()).match(/at (.+) \(eval at .+ \((.+)\), .+\)/))||(r=e.match(/at (.+) \((.+)\)/))||"at "!==e.slice(0,3)&&(r=e.match(/(.*)@(.*)/)))t=r[1],o=(r[2].match(/(.*):(\d+):(\d+)/)||r[2].match(/(.*):(\d+)/)||[]).slice(1);else{if(!(n=e.match(/^(at\s+)*(.+):(\d+):(\d+)/)))return;o=n.slice(2)}return{file:o[0],beforeParse:e,callee:t||"",line:parseInt(o[1]||"",10)||void 0,column:parseInt(o[2]||"",10)||void 0}})).filter((e=>void 0!==e))}const y=["initial","collection","property","manual","complete","error"];function m(e,t,n={},o=3){if("string"!=typeof t)throw new Error("reason must be a string");let i,c;("object"!=typeof n||Array.isArray(n))&&(n={value:n}),"error"===t?c=p(n.error):(i=p(),c=i[o]);const{callee:s,line:f,column:a,file:d,beforeParse:b}=c;let y=Symbol.for(t+"#"+b),m={...n,cause:e,reason:t,symbol:y,callee:s,line:f,column:a,file:d,stack:i};return m=e?.[r]?{...m,isSenal:!0}:e?.[l]?{...m,isTada:!0}:{...m},Object.defineProperty(m,u,{enumerable:!1,configurable:!1,writable:!1,value:!0}),m}function h(e,t,r={}){if(y.includes(t))throw new Error(`Cannot use reserved reason "${t}".`);return Object.freeze(m(e,t,r,4))}function g(e,t){return e.filter(((r,n)=>e.findIndex((e=>t(r,e)))===n))}let w;w="function"==typeof queueMicrotask?queueMicrotask:e=>Promise.resolve().then(e);let O=[],v=[],j=new Map;function A(e){const t=Symbol(),r=[];j.set(t,(t=>{for(const n of t)r.find((e=>e===n.symbol))||(r.push(n.symbol),e(n))})),w((()=>j.delete(t)))}function S(e,t){if(e.filters?.length){let n=!0;const o=[...e.filters.flat(1/0)];for(const e of o)if(e&&"object"==typeof e){const t=Object.entries(e).filter((([,e])=>!!e?.[r]));for(let[e,r]of t)o.push(r?.[e])}else if(!1===e||!0===e){if(!(n=e))break}else if(a(e)&&!(n=!1!==n&&!!e(t)))break;return n&&o.filter((e=>"string"==typeof e)).includes(t.reason)}return!1}function P(e){return e.completed||e.errored}const{push:x,pop:k,clear:E}=new function(e){const t=e,r=new Set,n=new Set;return{push:function(e,n=t){n&&[...r].find((t=>n(t,e)))||r.add(e)},pop:function(){let e=[...r].find((e=>!n.has(e)));return void 0!==e&&n.add(e),e},remaining:function(){return r.size-n.size},queued:r,processed:n,clear:function(){r.clear(),n.clear()}}};let N,M=!1;function _(e,t){if(!(P(e=e[l])||e.paused||e.inQueue||(x(e,((e,t)=>e.id===t.id)),e.inQueue=!0,t?.[u]||(t=m(e,"manual",t)),t=Object.freeze(t),M))){let r;for(M=!0;r=k();){if(S(r,t)){if(P(r)||r.paused)continue;if(P(e)||e.paused)break;N=r;try{r._next(t)}catch(e){M=!1,E(),e.inciter=t,r.error(e);break}N=void 0}r.inQueue=!1}M=!1,E()}}function z(e){return[e?.next,e?.error,e?.complete].some(a)}function Q(e,...t){if(!function(e){return!!a(e)||z(e)}(e))throw new Error("Computed function should be an observer or function.");if(e[l]?.disposed)return;const i=e;let u,c,s,f;const p=t=>{e.next(t)};if(p.unsubscribe=b,e?.[l])e=i[l],c=e.error,s=e.complete;else{if(e={started:!1,completed:!1,errored:!1,inQueue:!1,readOnly:!1,paused:0,id:Symbol(),next:function(t){if(P(e))return f;!e.started&&S({filters:e.filters},{reason:"initial"})&&_(e,m(e,"initial"));return e.started=!0,_(e,t),f},error:function(t){return P(e)||(_(e,m(e,"error",{error:t})),e.errored=!0,(c||(e=>{throw e}))(t)),f},complete:d,completeNextTick:function(){return w(d),f},addFilter:function(...t){if(P(e))return f;for(const r of t.flat(1/0))e.filters.includes(r)||e.filters.push(r);return f},unsubscribe:b,retro:function(t=!1){const i=function(){try{return[...g(v,((e,t)=>e.symbol===t.symbol))]}finally{O=[],v=[]}}();for(const{cause:l,property:u,type:c}of i)(t||"get"===c)&&l[r]&&(l[n](e,u),l[o](u));return f},pronto:function(t=!1){return P(e)||A((({cause:i,property:l,type:u})=>{(t||"get"===u)&&i[r]&&(i[n](e,l),i[o](l))})),f},*[Symbol.iterator](){const t=function(e,t=!0){const r=e[l];let n=r.readOnly;try{O=[],r.readOnly=!0;const e=m(r,"collection");return r.next(e),r.readOnly=n,t&&(O=g(O,((e,t)=>e.symbol===t.symbol))),[...O]}finally{O=[]}}(e);for(const e of t)"symbol"!=typeof e&&(yield e)}},e.filters=t.length?t.flat(1/0):["initial","property","collection","manual"],z(i)){const{next:t,error:r,complete:n,...o}=i;u=t,c=r,s=n,e={...e,...o}}else u=i;[e,i,p].forEach((t=>{Object.defineProperty(t,l,{value:e,configurable:!0,writable:!0,enumerable:!1})}))}return a(u)&&(e._next||=u),e.completed&&e.complete(),(!e.inQueue||e.errored||e.completed)&&S({filters:e.filters},{reason:"initial"})&&(_(e,m(e,"initial")),e.started=!0),f=new Proxy(p,{get:(t,r,n)=>Reflect.get(e,r,n),set:(t,r,n,o)=>(P(e)||(e[r]=n),!0)}),f;function d(){return P(e)||(_(e,m(e,"complete")),e.completed=!0,s?.()),f}function b(){e.complete()}}function R(e){let t=!1,r=e||N;if(r?.[l]){if(r[l].disposed)return e;r[l].complete()}else t=!0;if("function"!=typeof r&&"object"!=typeof r)throw new Error("Computed must be an observer or function.");return t&&(e[l]={disposed:!0}),e}const $=Object.getOwnPropertyNames(Object.getPrototypeOf({}));function C(e){return null!=e&&("object"==typeof e||"function"==typeof e)}const T=Object.getOwnPropertyNames(Object.getPrototypeOf([]));function q(e){let t=[];for(let r in e)t[+r]=e[r];return t}function I(e={},l={}){const{deep:u=!0,subscribeOnSet:c=!1,startReactive:s=!0,arrayToObject:f=!1}=l;if(!C(e))throw new Error("Senals first argument must be an object");const a=e=>(Array.isArray(e)||null!=e?.length&&"object"==typeof e)&&f;if(Array.isArray(e)&&!a(e))throw new Error("Arrays are not observable unless arrayToObject = true");a(e)&&(e=function(e){const t=e.length;return{...e,length:t}}(e));const p={},d={};let b=e?.[t];if(e[r])return e;if(e[r]=!0,u&&!b)for(const[t,r]of Object.entries(e))(C(r)||a(r))&&(Array.isArray(r)&&!a(r)||(e[t]=I(r)));function y(e,t){if(!b&&p[e]&&(function(e){return $.includes(e)}(e)&&![void 0,!0].includes(d[e])&&(d[e]=void 0),!d[e])){d[e]=!0;for(const r of p[e])r&&(r.completed||r.errored?delete p[e]:_(r,m(S,"property",t)));delete d[e]}}function h(e,t,r="get"){N?.errored||N?.completed?p[t]&&delete p[t]:function(e){if(v.length=0,O.push(e),O=g(O,((e,t)=>e.symbol===t.symbol)),v=[...O,...v],j.size>0)for(let e of j.values())"function"==typeof e?e(O):e.push(...O);w((()=>{O.length=0}))}(m(e,"property",{type:r,property:t,tada:N}))}function A(e,t,r=N){b||!function(e,t){if(null==e[t])return!0;const r=Object.getOwnPropertyDescriptor(e,t);return"__proto__"!==t&&{}.hasOwnProperty.call(e,t)&&r.configurable&&r.enumerable}(e,t)&&!a(e[t])||(e[t]&&!Object.getOwnPropertyDescriptor(e,t)?.writable&&Object.defineProperty(e,t,{value:e[t],writable:!0,enumerable:!0,configurable:!0}),r&&(Array.isArray(p[t])||(p[t]=[]),p[t].find((e=>e.id===r.id))||p[t].push(r)))}Object.defineProperties(e,{[n]:{enumerable:!1,configurable:!1,value:(t,r)=>A(e,r,t)},[o]:{enumerable:!1,configurable:!1,writeable:!1,value:(t,r={})=>y(t,{...r,value:e[t]})},[i]:{enumerable:!1,configurable:!1,writeable:!1,value:(t,r)=>h(e,t,r)}});const S=new Proxy(e,{get(r,n,o){if(n===t)return b;if(n===Symbol.iterator&&a(e)){const i=q(e);return function*(){for(let e of i)null!=e&&(yield e)}}if("symbol"!=typeof n)if(a(e)){if("length"===n)A(r,n),h(r,n,"get");else{if(T.includes(n)){let c=q(r);const s=c.length;return(...e)=>{let t=c[n](...e);Array.isArray(t)&&(c=t);for(let e=0;e<Math.max(c.length,r.length);e++)if(r[e]!==c[e])if(null!=c[e]){const t=r[e];r[e]=c[e],y(e,{value:r[e],prevValue:t}),h(r,e,"set")}else delete r[e];return r.length=Array.isArray(t)?t.length:Number(t)==Number(t)&&t>=0?t:null,u(s,r.length),t}}Number(n)==Number(n)&&l()}if(null!=r[n])return Reflect.get(r,n,o);function l(){for(let e=0;e<+n;e++)p[e]||A(r,e);const e=r.length,t=+(Object.keys(r).filter((e=>"length"!==e&&Number(e)==Number(e))).sort(((e,t)=>+e==+t)).reverse()[0]||0);u(e,0===t?0:t+1)}function u(e,t){r.length=t,y("length",{value:t,prevValue:e}),h(r,"length","set")}}else A(r,n),h(r,n,"get");return Reflect.get(r,n,o)},set(e,r,n,o){let i=e[r];return r===t?(b=n,!0):(u&&(C(n)||a(n))&&(Array.isArray(n)&&!a(n)||(n=I(n))),c&&A(e,r),(N&&!N.readOnly||!N)&&Reflect.set(e,r,n,o),y(r,{value:n,prevValue:i}),h(e,r,"set"),!0)}});return S}export{R as dispose,f as ignore,h as inciter,c as pause,I as senal,Q as tada};
