const e="senal-",t=Symbol.for(`${e}ig`),r=Symbol.for(`${e}ra`),n=Symbol.for(`${e}tada`),o=Symbol.for(`${e}incit`);function i(e){const t=e?.[n];if(t)return t.paused++,l.bind({done:!1},t)}function l(e){this.done||(e.paused=Math.max(e.paused-1,0),this.done=!0)}function c(e){if("object"!=typeof e||Array.isArray(e))throw new Error("Cannot ignore passed argument");return e[t]=!0,e}function s(e){return"function"==typeof e}const u=["initial","collection","property","manual","complete","error"];function a(e,t,i={},l=0){if("string"!=typeof t)throw new Error("reason must be a string");("object"!=typeof i||Array.isArray(i))&&(i={value:i});const{callee:c,line:s,column:u,file:a,beforeParse:f}=function(e=1){let t=(new Error).stack;return(e=Math.max(e,1))!=e&&(e=1),t=function(e){return(e||"").split("\n").map((e=>{let t,r,n,o=[];if((r=(e=e.trim()).match(/at (.+) \(eval at .+ \((.+)\), .+\)/))||(r=e.match(/at (.+) \((.+)\)/))||"at "!==e.slice(0,3)&&(r=e.match(/(.*)@(.*)/)))t=r[1],o=(r[2].match(/(.*):(\d+):(\d+)/)||r[2].match(/(.*):(\d+)/)||[]).slice(1);else{if(!(n=e.match(/^(at\s+)*(.+):(\d+):(\d+)/)))return;o=n.slice(2)}return{file:o[0],beforeParse:e,callee:t||"",line:parseInt(o[1]||"",10)||void 0,column:parseInt(o[2]||"",10)||void 0}})).filter((e=>void 0!==e))}(t).slice(e).map((e=>{return t=e,Object.assign(t,{calleeShort:t.calleeShort||(t.callee||"").split(".")[(t.callee||"").split(".").length-1]});var t})),t}(4+l)?.[0]||{};let d=Symbol.for(f),p={...i,cause:e,reason:t,symbol:d,callee:c,line:s,column:u,file:a};return p=e?.[r]?{...p,isSenal:!0}:e?.[n]?{...p,isTada:!0}:{...p},Object.defineProperty(p,o,{enumerable:!1,configurable:!1,writable:!1,value:!0}),p}function f(e,t,r={}){if(u.includes(t))throw new Error(`Cannot use reserved reason "${t}".`);return Object.freeze(a(e,t,r,-1))}function d(e,t){return e.filter(((r,n)=>e.findIndex((e=>t(r,e)))===n))}let p=[],y=[],b=new Map;function m(e,t){if(e.filters?.length){let n=!0;const o=[...e.filters.flat(1/0)];for(const e of o)if("object"!=typeof e){if(!1===e||!0===e){if(!(n=e))break}else if(s(e)&&!(n=!1!==n&&!!e(t)))break}else{const t=Object.entries(e).filter((([,e])=>!!e?.[r]));for(let[e,r]of t)o.push(r?.[e])}return!!n&&o.filter((e=>"string"==typeof e)).includes(t.reason)}return!0}function h(e){return e.completed||e.errored}const{push:g,pop:w,clear:O}=new function(e){const t=e,r=new Set,n=new Set;return{push:function(e,n=t){n&&[...r].find((t=>n(t,e)))||r.add(e)},pop:function(){let e=[...r].find((e=>!n.has(e)));return void 0!==e&&n.add(e),e},remaining:function(){return r.size-n.size},queued:r,processed:n,clear:function(){r.clear(),n.clear()}}};let v,j=!1;function x(e,t){if(!(h(e=e[n])||e.paused||e.inQueue||(g(e,((e,t)=>e.id===t.id)),e.inQueue=!0,t?.[o]||(t=a(e,"manual",t)),t=Object.freeze(t),j))){let e;for(j=!0;e=w();)if(!h(e)&&!e.paused){if(m(e,t)){v=e;try{(e._next||e.next)(t)}catch(r){r.instigator=t,e.error(r)}v=void 0}e.inQueue=!1}j=!1,O()}}function A(e){return[e?.next,e?.error,e?.complete].some(s)}function S(e,...t){if(!function(e){return!!s(e)||A(e)}(e))throw new Error("Computed function should be an observer or function.");if(e[n]?.disposed)return;const r=e;let o,i,l;const c=t=>{e.next(t)};if(c.unsubscribe=function(){e.complete()},e?.[n])e=r[n],i=e.error,l=e.complete;else{if(e={started:!1,completed:!1,errored:!1,inQueue:!1,readOnly:!1,paused:0,id:Symbol(),next:function(t){if(h(e))return e;!e.started&&m({filters:e.filters},{reason:"initial"})&&x(e,a(e,"initial"));return e.started=!0,x(e,t),e},error:function(t){return h(e)||(x(e,a(e,"error",{error:t})),e.errored=!0,(i||(e=>{throw e}))(t)),e},complete:u,completeNextTick:function(){return setTimeout(u),e},addFilter:function(...t){if(h(e))return e;for(const r of t.flat())e.filters.includes(r)||e.filters.push(r);return e},*[Symbol.iterator](){const t=function(e,t=!0){const r=e[n];let o=r.readOnly;try{p=[],r.readOnly=!0;const e=a(r,"collection");return r.next(e),r.readOnly=o,t&&(p=d(p,((e,t)=>e.symbol===t.symbol))),[...p]}finally{p=[]}}(e);for(const e of t)"symbol"!=typeof e&&(yield e)}},e.filters=t.length?t.flat():["initial","property","collection","manual"],A(r)){const{next:t,error:n,complete:c,...s}=r;o=t,i=n,l=c,e={...e,...s}}else o=r;[e,r,c].forEach((t=>{Object.defineProperty(t,n,{value:e,configurable:!0,writable:!0,enumerable:!1})}))}return s(o)&&(e._next||=o),e.completed&&e.complete(),(!e.inQueue||e.errored||e.completed)&&m({filters:t},{reason:"initial"})&&(x(e,a(e,"initial")),e.started=!0),new Proxy(c,{get(t,r,n){if(e[r])return Reflect.get(e,r,n)},set:(t,r,n,o)=>!!h(e)||(e[r]?Reflect.set(e,r,n,o):void 0)});function u(){return h(e)||(x(e,a(e,"complete")),e.completed=!0,l?.()),e}}function P(e){let t=!1,r=e||v;if(r?.[n]){if(r[n].disposed)return e;r[n].complete()}else t=!0;if("function"!=typeof r&&"object"!=typeof r)throw new Error("Computed must be an observer or function.");return t&&(e[n]={disposed:!0}),e}const E=Object.getOwnPropertyNames(Object.getPrototypeOf({}));function T(e){return null!=e&&("object"==typeof e||"function"==typeof e)}function _(e={},n={}){const{deep:o=!0,subscribeOnSet:i=!1,startReactive:l=!0,arrayToObject:c=!1}=n;if(!T(e))throw new Error("Senals first argument must be an object");if(Array.isArray(e)&&!c)throw new Error("Arrays are not observable unless arrayToObject = true");if(Array.isArray(e)&&c){const t=e.length;e={...e,length:t}}const s={},u={};let f=e?.[t];if(e[r])return e;if(e[r]=!0,o&&!f)for(const[t,r]of Object.entries(e))T(r)&&(Array.isArray(r)||(e[t]=_(r)));function m(e,t){if(!f&&s[e]&&(function(e){return E.includes(e)}(e)&&![void 0,!0].includes(u[e])&&(u[e]=void 0),!u[e])){u[e]=!0;for(const r of s[e])r&&(r.completed||r.errored?delete s[e]:x(r,a(w,"property",t)));delete u[e]}}function h(e,t,r="get"){!function(e){if(y.length=0,p.push(e),p=d(p,((e,t)=>e.symbol===t.symbol)),y=[...p,...y],b.size>0)for(let e of b.values())e.push(...p);setTimeout((()=>{p.length=0}))}(a(e,"property",{type:r,property:t,tada:v}))}function g(e,t){!f&&function(e,t){if(null==e[t])return!0;const r=Object.getOwnPropertyDescriptor(e,t);return"__proto__"!==t&&{}.hasOwnProperty.call(e,t)&&r.configurable&&r.enumerable}(e,t)&&(Object.getOwnPropertyDescriptor(e,t)?.writable||Object.defineProperty(e,t,{value:e[t],writable:!0,enumerable:!0,configurable:!0}),v&&(Array.isArray(s[t])||(s[t]=[]),s[t].find((e=>e.id===v.id))||s[t].push(v)))}const w=new Proxy(e,{get:(e,r,n)=>r===t?f:("symbol"!=typeof r&&(g(e,r),h(e,r,"get")),Reflect.get(e,r,n)),set(e,n,l,c){let s=e[n];return n===t?(f=l,!0):(n===r||(o&&T(l)&&(Array.isArray(l)||(l=_(l))),i&&g(e,n),(v&&!v.readOnly||!v)&&Reflect.set(e,n,l,c),m(n,{value:l,prevValue:s}),h(e,n,"set")),!0)}});return w}export{P as dispose,c as ignore,f as inciter,i as pause,_ as senal,S as tada};
